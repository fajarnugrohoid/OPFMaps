<!--
  ~ Copyright 2012-2015 One Platform Foundation
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<head>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
</head>

<body>
<div id="map" style="width: 100%; height: 100%"></div>

<script type="text/javascript">
    'use strict';

    ymaps.ready(init);
    var map,
            geoObjectsByIds = [],
            lastLocationGeoObjects,
            isZoomControlsEnabled = ZOOM_CONTROLS_ENABLED_STUB,
            isMyLocationEnabled = MY_LOCATION_ENABLED_STUB,
            isMyLocationButtonEnabled = MY_LOCATION_BUTTON_ENABLED_STUB;

    function init() {
        map = new ymaps.Map(
                "map",
                {
                    type: 'MAP_TYPE_STUB',
                    center: [CENTER_LAT_STUB, CENTER_LNG_STUB],
                    zoom: ZOOM_STUB,
                    behaviors: ['DRAG_STUB', 'MULTI_TOUCH_STUB', 'DBL_CLICK_STUB'],
                    controls: ['largeMapDefaultSet']
                },
                {
                    minZoom: 3
                }
        );
        map.container.enterFullscreen();


        if (isZoomControlsEnabled === false) {
            map.controls.remove('zoomControl')
        }

        if (isMyLocationButtonEnabled === false || isMyLocationEnabled === false) {
            map.controls.remove('geolocationControl')
        }

        if (isMyLocationEnabled) {
            showMyPosition();
        }

        map.events.add('actionbreak', function () {
            var center = map.getCenter();
            OnCameraChangeListener.onCameraChange(center[0], center[1], map.getZoom());
        });

        map.events.add('actionend', function () {
            var center = map.getCenter();
            OnCameraChangeListener.onCameraChange(center[0], center[1], map.getZoom());
        });

        map.events.add('sizechange', function () {
            var center = map.getCenter();
            OnCameraChangeListener.onCameraChange(center[0], center[1], map.getZoom());
        });

        map.events.add('typechange', function () {
            OnMapTypeChangeListener.onTypeChange(map.getType());
        });

        OnMapReadyCallback.onMapReady();
    }

    function addCircle(id, lat, lng, radius, fillColor, strokeColor, strokeWidth, zIndex, isVisible) {
        var circle = new ymaps.Circle([[lat, lng], radius], {}, {
            fillColor: fillColor,
            strokeColor: strokeColor,
            strokeWidth: strokeWidth,
            zIndex: zIndex,
            visible: isVisible
        });

        map.geoObjects.add(circle);
        geoObjectsByIds[id] = circle;
    }

    function removeGeoObject(id) {
        var geoObject = geoObjectsByIds[id];
        map.geoObjects.remove(geoObject);
        geoObjectsByIds.splice(id, 1);
    }

    function setGeoObjectOption(id, option, value) {
        var geoObject = geoObjectsByIds[id];
        geoObject.options.set(option, value);
    }

    function setGeoObjectCoordinates(id, lat, lng) {
        var geoObject = geoObjectsByIds[id];
        geoObject.geometry.setCoordinates([lat, lng]);
    }

    function setCircleRadius(id, radius) {
        var circle = geoObjectsByIds[id];
        circle.geometry.setRadius(radius);
    }

    function addMarker() {
        var myPlacemark = new ymaps.Placemark([55.76, 37.64], {
            content: 'Москва!',
            balloonContent: 'Столица России'
        });
        map.geoObjects.add(myPlacemark);
    }

    function setType(type) {
        map.setType(type);
    }

    function setCenter(lat, lng) {
        map.setCenter([lat, lng]);
    }

    function setZoom(zoom) {
        map.setZoom(zoom);
    }

    function setZoomControlsEnabled(isEnabled) {
        setControlEnabled('zoomControl', isEnabled);
    }

    function setZoomGesturesEnabled(isEnabled) {
        setBehaviorEnabled('multiTouch', isEnabled);
        setBehaviorEnabled('dblClickZoom', isEnabled);
    }

    function setScrollGesturesEnabled(isEnabled) {
        setBehaviorEnabled('drag', isEnabled);
    }

    function setMyLocationButtonEnabled(isEnabled) {
        isMyLocationButtonEnabled = isEnabled;

        setControlEnabled('geolocationControl', isMyLocationButtonEnabled && isMyLocationEnabled);
    }

    function setMyLocationEnabled(isEnabled) {
        isMyLocationEnabled = isEnabled;
        if (isMyLocationEnabled) {
            showMyPosition();
            setControlEnabled('geolocationControl', isMyLocationButtonEnabled);
        } else {
            hideMyPosition();
            setControlEnabled('geolocationControl', false);
        }
    }

    function setControlEnabled(controlName, isEnabled) {
        if (isEnabled) {
            map.controls.add(controlName);
        } else {
            map.controls.remove(controlName);
        }
    }

    function setBehaviorEnabled(behaviorName, isEnabled) {
        if (isEnabled) {
            map.behaviors.enable(behaviorName);
        } else {
            map.behaviors.disable(behaviorName);
        }
    }

    function showMyPosition() {
        ymaps.geolocation.get().then(function(result) {
            lastLocationGeoObjects = result.geoObjects;
            map.geoObjects.add(lastLocationGeoObjects);
        });
    }

    function hideMyPosition() {
        map.geoObjects.remove(lastLocationGeoObjects);
    }
</script>
</body>
